<% content_for :title, "Championship Results" %>

<div class="min-h-screen bg-[#0F0F0F] text-white p-4 md:p-6">
  <!-- Header -->
  <div class="flex items-center gap-4 mb-8">
    <a href="<%= root_path %>" class="w-10 h-10 bg-[#1A1A1A] rounded-full flex items-center justify-center hover:bg-[#222] transition">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
      </svg>
    </a>
    <div>
      <h1 class="text-2xl font-bold">Classifica√ß√£o Geral</h1>
      <p class="text-gray-400">Temporada <%= @year %></p>
    </div>
  </div>

  <% if notice.present? %>
    <div class="mb-6 p-4 bg-green-900/20 border border-green-700/30 rounded-lg text-green-400">
      <%= notice %>
    </div>
  <% end %>

  <!-- Top 3 Podium -->
  <% if @top_three.any? %>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
      <!-- 2nd Place -->
      <% if @top_three[1] %>
        <div class="order-2 md:order-1">
          <div class="rounded-2xl p-6 bg-gradient-to-b from-[#2A2A2A] to-[#1A1A1A] text-center relative overflow-hidden border border-gray-800">
            <div class="absolute top-4 right-4 text-4xl opacity-20">ü•à</div>
            <div class="text-5xl font-black text-gray-300 mb-4">2¬∫</div>
            <div class="text-lg font-bold mb-1">
              <%= @top_three[1].user.name.presence || "Usu√°rio ##{@top_three[1].user_id}" %>
            </div>
            <div class="text-2xl font-bold text-gray-300 mb-2">
              <%= @top_three[1].points || 0 %> pts
            </div>
          </div>
        </div>
      <% end %>

      <!-- 1st Place -->
      <% if @top_three[0] %>
        <div class="order-1 md:order-2">
          <div class="rounded-2xl p-8 bg-gradient-to-b from-[#FFD700]/10 to-[#1A1A1A] text-center relative overflow-hidden border border-[#FFD700]/30">
            <div class="absolute top-6 right-6 text-5xl opacity-30">üèÜ</div>
            <div class="text-6xl font-black text-[#FFD700] mb-6">1¬∫</div>
            <div class="text-xl font-bold mb-2">
              <%= @top_three[0].user.name.presence || "Usu√°rio ##{@top_three[0].user_id}" %>
            </div>
            <div class="text-3xl font-bold text-white mb-3">
              <%= @top_three[0].points || 0 %> pts
            </div>
          </div>
        </div>
      <% end %>

      <!-- 3rd Place -->
      <% if @top_three[2] %>
        <div class="order-3">
          <div class="rounded-2xl p-6 bg-gradient-to-b from-[#2A2A2A] to-[#1A1A1A] text-center relative overflow-hidden border border-gray-800">
            <div class="absolute top-4 right-4 text-4xl opacity-20">ü•â</div>
            <div class="text-5xl font-black text-gray-300 mb-4">3¬∫</div>
            <div class="text-lg font-bold mb-1">
              <%= @top_three[2].user.name.presence || "Usu√°rio ##{@top_three[2].user_id}" %>
            </div>
            <div class="text-2xl font-bold text-gray-300 mb-2">
              <%= @top_three[2].points || 0 %> pts
            </div>
          </div>
        </div>
      <% end %>
    </div>
  <% end %>

  <!-- Rest of Rankings -->
  <div class="space-y-2">
    <% if @rest.any? %>
      <% @rest.each_with_index do |result, index| %>
        <% position = index + 4 %>
        <% is_current_user = result.user_id == current_user.id %>

        <div class="<%= is_current_user ? 'bg-gradient-to-r from-[#FFD700]/10 to-transparent border border-[#FFD700]/20' : 'bg-[#1A1A1A]' %> rounded-xl p-4 flex items-center gap-4 transition hover:bg-[#222]">
          <div class="w-10 text-center">
            <span class="text-lg font-bold <%= is_current_user ? 'text-[#FFD700]' : 'text-gray-400' %>">
              <%= position %>¬∫
            </span>
          </div>

          <div class="flex-1">
            <div class="font-semibold <%= is_current_user ? 'text-[#FFD700]' : 'text-white' %>">
              <% if is_current_user %>
                <span class="flex items-center gap-2">
                  <%= result.user.name.presence || "Voc√™" %>
                  <span class="text-xs px-2 py-1 bg-[#FFD700]/20 rounded-full">Voc√™</span>
                </span>
              <% else %>
                <%= result.user.name.presence || "Usu√°rio ##{result.user_id}" %>
              <% end %>
            </div>
            <div class="text-sm text-gray-400">
              <%= result.points || 0 %> pontos ‚Ä¢
              <%= result.bets_count || 0 %> <%= (result.bets_count || 0) == 1 ? 'aposta' : 'apostas' %>
            </div>
          </div>

          <!-- Position change indicator (optional - you can remove if not tracking) -->
          <% if result.position_change %>
            <div class="flex items-center gap-1 <%= result.position_change > 0 ? 'text-green-400' : 'text-red-400' %> text-sm">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <% if result.position_change > 0 %>
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/>
                <% else %>
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 17h8m0 0V9m0 8l-8-8-4 4-6-6"/>
                <% end %>
              </svg>
              <%= result.position_change.abs %>
            </div>
          <% end %>
        </div>
      <% end %>
    <% end %>

    <!-- If no results found -->
    <% if @championship_results.empty? %>
      <div class="text-center py-12">
        <div class="text-4xl mb-4">üèÅ</div>
        <h3 class="text-xl font-bold text-white mb-2">Nenhum Resultado</h3>
        <p class="text-gray-400">Ainda n√£o h√° dados de classifica√ß√£o para a temporada <%= @year %></p>
        <%= link_to "Fazer Primeira Aposta", races_path, class: "mt-4 inline-block px-6 py-3 bg-gradient-to-r from-[#FF8700] to-purple-600 text-white font-semibold rounded-lg hover:opacity-90 transition" %>
      </div>
    <% end %>
  </div>

  <!-- Current User Summary (if not in top 3) -->
  <% if @user_result && @user_position > 3 %>
    <div class="mt-8 p-4 bg-gradient-to-r from-[#1A1A1A] to-[#0F0F0F] rounded-xl border border-gray-800">
      <h3 class="font-bold text-lg mb-3">Sua Posi√ß√£o</h3>
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
        <div class="text-center p-4 bg-[#0F0F0F] rounded-lg">
          <div class="text-3xl font-bold text-[#FFD700]"><%= @user_position %>¬∫</div>
          <div class="text-sm text-gray-400">Posi√ß√£o</div>
        </div>
        <div class="text-center p-4 bg-[#0F0F0F] rounded-lg">
          <div class="text-3xl font-bold text-white"><%= @user_result.points || 0 %></div>
          <div class="text-sm text-gray-400">Pontos</div>
        </div>
        <% if @top_three[0] %>
          <div class="text-center p-4 bg-[#0F0F0F] rounded-lg">
            <div class="text-3xl font-bold <%= (@user_result.points || 0) < (@top_three[0].points || 0) ? 'text-red-400' : 'text-green-400' %>">
              <%= (@top_three[0].points || 0) - (@user_result.points || 0) %>
            </div>
            <div class="text-sm text-gray-400">Do l√≠der</div>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>
</div>
