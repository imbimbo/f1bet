<h1 class="text-3xl font-bold mb-6 text-white">Corridas</h1>

<div class="space-y-3">
  <% @races.each do |race| %>
    <div
      class="rounded-lg border border-gray-800 overflow-hidden"
      data-controller="accordion"
    >
      <!-- Linha da corrida -->
      <button
        type="button"
        data-action="click->accordion#toggle"
        class="
          w-full flex justify-between items-center
          px-5 py-4
          bg-gray-900 hover:bg-gray-800
          transition-colors
        "
      >
        <div class="text-left">
          <p class="text-white font-semibold text-lg">
            <%= race_display_name(race) %>
          </p>

          <p class="text-sm text-gray-400 mt-0.5">
            <%= l(race.date, format: :long) %>
            •
            <%= race.race_type_label %>
          </p>
        </div>

        <span
          data-accordion-target="icon"
          class="text-gray-400 transform transition-transform"
        >
          ▼
        </span>
      </button>

      <!-- Conteúdo expandido -->
      <div
        data-accordion-target="content"
        class="hidden bg-gray-950 px-5 py-4"
      >
        <% bet ||= @bet || current_user.bets.find_by(race: race) || Bet.new(submitted: false) %>
        <%# Ensure race is defined (derive from bet if missing) %>
        <% race ||= bet&.race %>
        <%= render "bets/grid",
            race: race,
              # If bet exists, use its order; otherwise fallback to race drivers
            drivers: (bet ? bet.ordered_drivers : race.drivers),
            bet: bet %>

      </div>
    </div>
  <% end %>
</div>
