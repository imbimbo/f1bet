<% content_for :title, race_display_name(@main_race) %>

<div class="mb-8">
  <!-- Nome do GP -->
  <h1 class="text-4xl md:text-5xl font-black italic uppercase tracking-tighter text-white">
    <%= race_display_name(@main_race) %>
  </h1>

  <!-- Local + Data/Hora BR -->
  <p class="text-gray-400 mt-2 text-lg">
    <%= @main_race.location %>
    •
    <%= l(@main_race.start_time.in_time_zone("America/Sao_Paulo"), format: :long) %>
    (Horário de Brasília)
  </p>

  <!-- Imagem do circuito -->
  <% if @main_race.circuit_image_url.present? %>
    <div class="mt-6 flex justify-center">
      <%= image_tag @main_race.circuit_image_url,
        alt: "Circuit layout",
        class: "max-h-56 object-contain opacity-90" %>
    </div>
  <% end %>
</div>

<div class="space-y-4">
  <% @sessions.each do |race| %>
    <div
      class="rounded-lg border border-gray-800 overflow-hidden"
      data-controller="accordion"
        >
        <!-- Linha da corrida -->
      <button
        type="button"
        data-action="click->accordion#toggle"
        class="
          w-full flex justify-between items-center
          px-5 py-4
          bg-gray-900 hover:bg-gray-800
          transition-colors">
        <div class="text-left">
          <p class="text-white font-semibold text-lg">
            <%= race.race_type_label %>
          </p>

          <p class="text-sm text-gray-400 mt-0.5">
            <%= l(race.date, format: :long) %>

          </p>
        </div>

      </button>

          <!-- Conteúdo expandido -->
      <div
        data-accordion-target="content"
        class="hidden bg-gray-950 px-5 py-4">

        <% bet ||= @bet || current_user.bets.find_by(race: race) || Bet.new(submitted: false) %>
        <%# Ensure race is defined (derive from bet if missing) %>
        <% race ||= bet&.race %>
        <%= render "bets/grid",
            race: race,
              # If bet exists, use its order; otherwise fallback to race drivers
            drivers: (bet ? bet.ordered_drivers : race.drivers),
            bet: bet %>
      </div>
    </div>
  <% end %>
</div>
